


<!-- Modal content -->
<div id="myModalPopUp" class="modal-content">
    <span id="closeButton">&times;</span>
    <div class="flex-row flag-header-row">
        <img src="https://www.countryflags.io/be/flat/24.png" alt="Country flag">
        <h2 id="routingInfoHeader" style="color: #282828">You are from ....</h2>
    </div>
    <div class="flex-row text-button-row">
        <p id="routingInfoText" style="color: #282828">Some text in the Modal.. </p>
        <button type="button" id="routingLink">www.junglegym.nl</button>

    </div>
</div>


<!-- Script for visitor routing -->
<script>

    [`Nl: Hé! Wij denken dat je in Nederland bent. Winkel daar`, 
    `Fr: Hey! Il semblerait que vous soyez en France. Shop ici`,
    `De: Hi! Wir denken, dass du dich in Deutschland befindest. Jetzt shoppen`,
    `Es: !Hola! Creemos que estas en España. Compra aquí`,
    `En: Hey! We think you are in Netherlands. Shop there`];

    var Websites = {
        INT: ["https://www.junglegym.com", "International"],
        NL: ["https://www.junglegym.nl", "Nederland"],
        DK: ["https://www.junglegym.dk", "Danmark"],
        EE: ["https://www.junglegym.ee", "Esti"],
        ES: ["https://www.junglegym.es", "España"],
        FR: ["https://www.junglegym.fr", "France"],
        GR: ["https://www.junglegym.gr", "Ελλάδα"],
        IS: ["https://www.junglegym.is", "Ísland"],
        MK: ["https://www.junglegym.mk", "Makedonija"],
        AT: ["https://www.junglegym.at", "Österreich"],
        BE: ["https://www.junglegym.be", "Belgium"],
        DE: ["https://www.junglegym.de", "Deutschland"],
        IT: ["https://www.junglegym.it", "Italia"],
        IE: ["https://www.junglegym.ie", "Ireland"],
        LV: ["https://www.junglegym.lv", "Latvija"],
        LU: ["https://www.junglegym.lu", "Luxemburg"],
        PT: ["https://www.junglegym.pt", "Portugal"],
        CH: ["https://www.junglegym.ch", "Swiss"],
        SI: ["https://www.junglegym.si", "Slovenija"],
        ZA: ["https://www.junglegym.co.za", "South Africa"],
        NO: ["https://www.junglegym.co.no", "Norge"],
        FI: ["https://www.junglegym.fi", "Suomi"],
        SE: ["https://www.junglegym.se", "Sverige"],
        PL: ["https://www.junglegym.pl", "Polska"],
        UA: ["https://www.junglegym.ua", "Україна"],
        UK: ["https://www.junglegym.co.uk", "UK"]
    };
    var landedSite = window.location.hostname;
    var landedSiteCountry = landedSite.slice(-2).toUpperCase();
    if (landedSiteCountry === "UK") {
        landedSiteCountry = "GB";
    }
    var visitorCountry;
    var visitorCountryName;
    // Get the modal
    //var modal = document.getElementById("myModalPopUp");
    // Get the closeButton ID that closes the modal
    var closeButton = document.getElementById("#closeButton");
    require(["jquery", "domReady!"], function ($) {
        console.log(`Landed site is ${landedSite}
             Language of the website is ${landedSiteCountry}`);
        try {
            $.ajax({
                url: "https://geoip-db.com/jsonp",
                jsonpCallback: "callback",
                dataType: "jsonp",
                success: function (location) {
                    visitorCountry = location.country_code;
                    visitorCountryName = location.country_name;
                    console.log(visitorCountryName)
                    // If landed site is other than where user is from
                    if (landedSiteCountry !== visitorCountry) {
                        //Modal Pop up appears when visitor is at the wrong page
                        $("#myModalPopUp").css("display", "block");
                        //$(".page-wrapper>*:not(#myModalPopUp)").css("filter", "blur(3px)");
                        // When the user clicks on (x), close the modal
                        $("#closeButton").click(function () {
                            $("#myModalPopUp").remove();
                            //$(".page-wrapper>*:not(#myModalPopUp)").css("filter", "none");
                        });
                        $(".flag-header-row img").attr("src", ('https://www.countryflags.io/' + visitorCountry + '/flat/24.png'));
                        $("#routingInfoHeader").text("You are from " + visitorCountryName + "!");
                        $("#routingInfoText").text("Go to > ");
                        var linkToShow = "";
                        // If the user is from a country we have a website for
                        if (Websites.hasOwnProperty(visitorCountry)) {
                            linkToShow = Websites[visitorCountry][0];
                            // the green button takes the visitor to the right website
                            $("#routingLink").click(function () {
                                window.open(linkToShow, '_self');
                            });
                            // The text on the button is replaced with the country specific Jungle Gym name
                            $("#routingLink").text("Jungle Gym " + Websites[visitorCountry][1]);
                            //.com website is suggested if the user is from a country we do not
                            // have a dedicated website for
                        } else {
                            // Link to show is replaced with www.junglegym.com
                            linkToShow = Websites[INT][0];
                            $("#routingLink").text("Jungle Gym International");
                            //green button takes the user to the international website.
                            $("#routingLink").click(function () {
                                window.open(linkToShow, '_self');
                            });
                        }

                        
                        // $(window).scroll(function () {
                        //     if ($(this).scrollTop() > 3000) {
                        //         //  $("#myModalPopUp").css("display", "none");
                        //         $("#myModalPopUp").fadeOut(1000);
                        //     } else {
                        //         $("#myModalPopUp").css("display", "block");
                        //     }
                        // });
                        // $(window).scroll(function () {
                        //     if ($('body').height() <= ($(window).height() + $(window).scrollTop())) {
                        //         $("#myModalPopUp").css("opacity", 0 );
                        //     } 
                        //     else {
                        //         $("#myModalPopUp").css("opacity", 1 );
                        //     }
                        // });
                    }
                }
            });
        }
        catch (err) {
            console.error("Geoip-db.com is not working!");
            console.error(err.message + ' ' + err.name);
        }
    });
</script>


<!--Geo Location Pop up related styles-->
<style>
    /* Modal Content */
    .modal-content {
        z-index: 9500;
        display: none;
        position: fixed;
        justify-content: center;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #fefefe;
        box-shadow: 0 0 0 2px rgb(255, 255, 255), 0.3em 0.3em 1em rgba(0, 0, 0, 0.3);
    }
    /* The Close Button */
    #closeButton {
        right: 2%;
        font-weight: 300;
        color: #aaaaaa;
        float: right;
        font-size: 2.7em;
        position: absolute;
    }
    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    #routingLink {
        border-radius: 0 !important;
        margin-top: -5px;
        display: inline-block;
        text-align: center;
        padding: 2px 12px 2px 12px;
        background-color: rgb(78, 196, 37);
        border: none;
        color: rgb(255, 255, 255);
        cursor: pointer;
        font-size: 1;
        font-weight: 600;
        text-align: center;
        margin-left: 5px;
    }
    #routingInfoHeader {
        display: table;
        padding: 0 5px;
        font-weight: 300;
        text-align: center;
        font-size: 1.3em;
        display: inline-block;
    }
    #routingInfoText {
        font-size: 1em;
        text-align: center;
        display: inline-block;
        margin-right: 5px;
        font-weight: 300;
    }
    .flag-header-row img {
        padding-right: 5px;
        padding-bottom: 5px;
    }
    .flag-header-row {
        display: table;
        margin: -6px auto -6px auto;
    }
    .flex-row.text-button-row {
        display: table;
        margin: 0 auto 0 auto;
    }
    @media(max-width: 800px){
    body.catalog-product-view .modal-content{
        z-index: 8;
        /* display: none; */
        position: fixed;
        justify-content: center;
        bottom: 106px;
        left: 0;
        padding-bottom: 10px;
        right: 0;
        background-color: #fefefe;
        box-shadow: 0 0 0 2px rgb(255, 255, 255), 0.3em 0.3em 1em rgba(0, 0, 0, 0.3);
    }
}
</style>
